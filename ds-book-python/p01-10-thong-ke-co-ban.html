

<!DOCTYPE html>
<html class="writer-html5" lang="vn" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. Các chỉ số thống kê mô tả cơ bản &mdash; Phân tích dữ liệu với Python 2022 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=0cebd926" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=a798377f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "displayMath": [["$$", "$$"], ["\\[", "\\]"]]}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11. Bản đồ với folium" href="p01-11-map-folium.html" />
    <link rel="prev" title="9. Numpy" href="p01-09-numpy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Phân tích dữ liệu với Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Python cơ bản</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p01-01-gioi-thieu-python.html">1. Giới thiệu về Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-02-python-ide.html">2. Python IDE - Jupyter lab &amp; Visual Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-03-cau-truc-du-lieu-python.html">3. Các cấu trúc cơ bản trong Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-04-pandas.html">4. Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-05-polars.html">5. Polars</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-06-ngu-phap-bieu-do.html">6. Ngữ pháp của biểu đồ</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-07-datetime.html">7. Dữ liệu thời gian trong Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-08-lam-viec-voi-text.html">8. Biến đổi dữ liệu text trong python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-09-numpy.html">9. Numpy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. Các chỉ số thống kê mô tả cơ bản</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cac-chi-so-thong-ke-co-ban">10.1. Các chỉ số thống kê cơ bản</a></li>
<li class="toctree-l2"><a class="reference internal" href="#phan-tich-moi-quan-he-2-bien-lien-tuc-correlation">10.2. Phân tích mối quan hệ 2 biến liên tục - correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#anova">10.3. ANOVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kiem-dinh-quan-he-chi-binh-phuong">10.4. Kiểm định quan hệ Chi-bình phương</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prop-test">10.5. Prop test</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simpson-paradox">10.6. Simpson paradox</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p01-11-map-folium.html">11. Bản đồ với <code class="docutils literal notranslate"><span class="pre">folium</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-99-tricks-python.html">12. Các mẹo trong Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lập trình trong Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p02-01-lap-trinh-doi-tuong-python.html">1. Lập trình hướng - đối tượng với Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02-02-functions-in-python.html">2. Viết hàm trong Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine learning với sklearn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p05-01-sklearn.html">1. Giới thiệu cơ bản về Scikit learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-02-sklearn-advanced.html">2. sklearn nâng cao</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-03-xgboost.html">3. Xgboost với sklearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-07-machine-learning-h2o.html">4. Machine learning với <code class="docutils literal notranslate"><span class="pre">H2O</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="p05-20-api-flask.html">5. Xây dựng API dự báo với Flask</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kiến thức bổ trợ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="p06-01-so-sanh-python-r.html">1. So sánh R với Python cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-02-matplotlib.html">2. Trực quan hóa với Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06-03-seaborn.html">3. Trực quan hóa với Seaborn</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phân tích dữ liệu với Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">10. </span>Các chỉ số thống kê mô tả cơ bản</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/p01-10-thong-ke-co-ban.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="cac-chi-so-thong-ke-mo-ta-co-ban">
<h1><span class="section-number">10. </span>Các chỉ số thống kê mô tả cơ bản<a class="headerlink" href="#cac-chi-so-thong-ke-mo-ta-co-ban" title="Link to this heading"></a></h1>
<p>Trong quá trình phân tích dữ liệu, việc nắm vững các chỉ số thống kê cơ bản là rất quan trọng. Tuy nhiên, vấn đề còn nằm ở khả năng diễn đạt các chỉ số thống kê thành các ngôn ngữ thân thuộc trong kinh doanh. Các chỉ số thống kê mô tả cho 1 biến có tính thực tiễn cao bao gồm:</p>
<ul class="simple">
<li><p>Giá trị trung bình</p></li>
<li><p>Giá trị trung bình sau khi loại bỏ <code class="docutils literal notranslate"><span class="pre">outlier</span></code></p></li>
<li><p>Nhóm tứ phân vị (<code class="docutils literal notranslate"><span class="pre">quartile</span></code>), <code class="docutils literal notranslate"><span class="pre">percentile</span></code></p></li>
<li><p>Trung vị (<code class="docutils literal notranslate"><span class="pre">median</span></code>)</p></li>
<li><p>Giá trị nhỏ nhất, lớn nhất</p></li>
<li><p>Độ lệch tiêu chuẩn (<code class="docutils literal notranslate"><span class="pre">standard</span> <span class="pre">deviation</span></code>) (ít dùng trong kinh doanh thực tiễn)</p></li>
</ul>
<p>Bên cạnh đó, khi so sánh giữa 2 biến với nhau, ta cũng cần nắm vững các phương pháp sau:</p>
<ul class="simple">
<li><p>So sánh 1 biến liên tục với 1 biến rời rạc - Phương pháp phân tích phương sai - <code class="docutils literal notranslate"><span class="pre">ANOVA</span></code></p></li>
<li><p>So sánh 2 biến liên tục - Đánh giá hệ số tương quan - <code class="docutils literal notranslate"><span class="pre">correlation</span></code></p></li>
<li><p>So sánh 2 biến rời rạc - Phương pháp đánh giá chỉ số khi-bình phương - <code class="docutils literal notranslate"><span class="pre">Chi-Square</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">prop.test</span></code></p></li>
<li><p>Lưu ý với nghịch lý Simpson (<code class="docutils literal notranslate"><span class="pre">Simpson</span> <span class="pre">paradox</span></code>)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="rubric" id="luu-y">Lưu ý</p>
<p>Đây là chương rất quan trọng và tổng hợp phần lớn các kỹ thuật thống kê thường dùng khi phân tích dữ liệu thực tế. Thành thạo ứng dụng các kỹ thuật này có thể giúp phân tích và tìm kiếm insight nhanh chóng với khoảng 80%-85% các bài toán phân tích ứng dụng thực tế.</p>
</div>
<section id="cac-chi-so-thong-ke-co-ban">
<h2><span class="section-number">10.1. </span>Các chỉ số thống kê cơ bản<a class="headerlink" href="#cac-chi-so-thong-ke-co-ban" title="Link to this heading"></a></h2>
<p>Giả sử ta có 1 tập hơn 1000 khách hàng với thu nhập như sau.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lets_plot</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>

<span class="c1"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Generate income values</span>
<span class="n">random_income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">995</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">extra_income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">])</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">random_income</span><span class="p">,</span> <span class="n">extra_income</span><span class="p">])</span>
<span class="n">income_series</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">income</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <div id="2eMsKY"></div>
            <script type="text/javascript" data-lets-plot-script="library">
                if(!window.letsPlotCallQueue) {
                    window.letsPlotCallQueue = [];
                }; 
                window.letsPlotCall = function(f) {
                    window.letsPlotCallQueue.push(f);
                };
                (function() {
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js";
                    script.onload = function() {
                        window.letsPlotCall = function(f) {f();};
                        window.letsPlotCallQueue.forEach(function(f) {f();});
                        window.letsPlotCallQueue = [];
                        
                    };
                    script.onerror = function(event) {
                        window.letsPlotCall = function(f) {};    // noop
                        window.letsPlotCallQueue = [];
                        var div = document.createElement("div");
                        div.style.color = 'darkred';
                        div.textContent = 'Error loading Lets-Plot JS';
                        document.getElementById("2eMsKY").appendChild(div);
                    };
                    var e = document.getElementById("2eMsKY");
                    e.appendChild(script);
                })()
            </script>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show first few values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">income_series</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (10,)
Series: &#39;&#39; [i32]
[
	16
	23
	6
	13
	9
	8
	10
	14
	15
	18
]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tổng hợp thống kê</span>
<span class="n">income_series</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 2)</small><table border="1" class="dataframe"><thead><tr><th>statistic</th><th>value</th></tr><tr><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;count&quot;</td><td>999.0</td></tr><tr><td>&quot;null_count&quot;</td><td>0.0</td></tr><tr><td>&quot;mean&quot;</td><td>28.444444</td></tr><tr><td>&quot;std&quot;</td><td>196.523392</td></tr><tr><td>&quot;min&quot;</td><td>6.0</td></tr><tr><td>&quot;25%&quot;</td><td>12.0</td></tr><tr><td>&quot;50%&quot;</td><td>18.0</td></tr><tr><td>&quot;75%&quot;</td><td>24.0</td></tr><tr><td>&quot;max&quot;</td><td>5000.0</td></tr></tbody></table></div></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Min</span></code>: giá trị nhỏ nhất - thu nhập thấp nhất của khách hàng là 6 triệu</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Max</span></code>: giá trị lớn nhất - khách hàng có thu nhập cao nhất là 5 tỷ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">First</span> <span class="pre">quantile</span></code>: quantile 25%</p>
<ul>
<li><p><strong>Cách 1</strong>: Tứ phân vị thứ nhất là 12 triệu</p></li>
<li><p><strong>Cách 2</strong>: Có 25% khách hàng có thu nhập nhỏ hơn hoặc bằng 12 triệu hoặc</p></li>
<li><p><strong>Cách 3</strong>: Có 75% khách hàng có thu nhập lớn hơn hoặc bằng 12 triệu hoặc</p></li>
<li><p><strong>Cách 4</strong>: Cứ 4 khách hàng thì có 1 khách hàng có thu nhập nhỏ hơn hoặc bằng 12 triệu</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Median</span></code>: giá trị trung vị - quantile 50%</p>
<ul>
<li><p><strong>Cách 1</strong>: Trung vị có giá trị 18 triệu</p></li>
<li><p><strong>Cách 2</strong>: 50% khách hàng có thu nhập nhỏ hơn hoặc bằng 18 triệu</p></li>
<li><p><strong>Cách 3</strong>: Có 50% khách hàng có thu nhập lớn hơn hoặc bằng 18 triệu hoặc</p></li>
<li><p><strong>Cách 4</strong>: Cứ 2 khách hàng thì có 1 khách hàng có thu nhập lớn hơn hoặc bằng 18 triệu</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Third</span> <span class="pre">quantile</span></code>: quantile 75% - tứ phân vị thứ 3 - 24 triệu</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mean</span></code>: giá trị trung bình - thu nhập trung bình của khách hàng là 5000 triệu</p></li>
</ul>
<p>Để trực quan hóa các chỉ số thống kê vừa đề cập, ta có thể sử dụng biểu đồ <code class="docutils literal notranslate"><span class="pre">boxplot</span></code>. Biểu đồ <code class="docutils literal notranslate"><span class="pre">boxplot</span></code> thể hiện các thành phần như sau.</p>
<p><img alt="" src="_images/p02-04-boxplot.png" /></p>
<p>Với biểu đồ trên, ta còn thấy có 2 nhóm chỉ số bổ sung nâng cao:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IQR</span></code>: Inter Quaritle Range - là độ rộng của boxplot, là <code class="docutils literal notranslate"><span class="pre">Q3-Q1</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">income_series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span> <span class="n">income_series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.0
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Outlier</span></code>: Là các quan sát có giá trị quá cao hoặc quá thấp. Về mặt thống kê, các outlier được định nghĩa là các giá trị nằm ngoài khoảng <span class="math notranslate nohighlight">\((\text{Q}_1 - 1.5\times \text{IQR}, \text{Q}_3 + 1.5\times \text{IQR})\)</span></p></li>
</ul>
<hr class="docutils" />
<p>Bên cạnh đó, do việc xuất hiện các quan sát ngoại lại (<code class="docutils literal notranslate"><span class="pre">outlier</span></code>) là thường xuyên và có thể gây méo các chỉ số, ta cần quan tâm thêm 2 chỉ số sau</p>
<ul class="simple">
<li><p>Giá trị trung bình loại bỏ outlier</p></li>
<li><p>Các percentile - các mốc phân vị từ 1%-100%</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean loại bỏ 5% đầu và 5% cuối</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">trim_mean</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">trim_mean</span><span class="p">(</span><span class="n">income_series</span><span class="p">,</span> <span class="n">proportiontocut</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.56159822419534
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Xem xét các mốc percentile</span>
<span class="p">[</span><span class="n">income_series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6.0,
 6.0,
 6.0,
 6.0,
 6.0,
 6.0,
 7.0,
 7.0,
 7.0,
 8.0,
 8.0,
 8.0,
 9.0,
 9.0,
 9.0,
 9.0,
 9.0,
 10.0,
 10.0,
 10.0,
 10.0,
 11.0,
 11.0,
 11.0,
 11.0,
 12.0,
 12.0,
 12.0,
 12.0,
 12.0,
 13.0,
 13.0,
 13.0,
 14.0,
 14.0,
 14.0,
 14.0,
 15.0,
 15.0,
 15.0,
 15.0,
 16.0,
 16.0,
 16.0,
 16.0,
 16.0,
 17.0,
 17.0,
 17.0,
 17.0,
 18.0,
 18.0,
 18.0,
 18.0,
 19.0,
 19.0,
 19.0,
 19.0,
 19.0,
 20.0,
 20.0,
 20.0,
 20.0,
 21.0,
 21.0,
 21.0,
 22.0,
 22.0,
 22.0,
 22.0,
 22.0,
 23.0,
 23.0,
 23.0,
 23.0,
 24.0,
 24.0,
 24.0,
 24.0,
 25.0,
 25.0,
 25.0,
 25.0,
 25.0,
 26.0,
 26.0,
 26.0,
 26.0,
 27.0,
 27.0,
 27.0,
 27.0,
 28.0,
 28.0,
 28.0,
 28.0,
 29.0,
 29.0,
 29.0,
 29.0,
 5000.0]
</pre></div>
</div>
</div>
</div>
</section>
<section id="phan-tich-moi-quan-he-2-bien-lien-tuc-correlation">
<h2><span class="section-number">10.2. </span>Phân tích mối quan hệ 2 biến liên tục - correlation<a class="headerlink" href="#phan-tich-moi-quan-he-2-bien-lien-tuc-correlation" title="Link to this heading"></a></h2>
<p><strong>Hệ số tương quan</strong></p>
<p>Hệ số tương quan (correlation coefficient) là một chỉ số thống kê, được sử dụng để đo lường mối liên hệ tương quan tuyến tính giữa 2 biến định lượng hay còn gọi là biến liên tục (quantitative/continuous variables). Hay nói một cách dễ hiểu hơn, hệ số tương quan cho ta biết rằng giữa 2 biến liên tục có mối liên hệ <em>tuyến tính</em> nào hay không.</p>
<p>Thể hiện quan hệ tuyến tính giữa hai hay nhiều biến. Có giá trị nằm trong khoảng [-1,1]</p>
<ul class="simple">
<li><p>Giá trị âm: Quan hệ nghịch biến</p></li>
<li><p>Giá trị dương: Quan hệ đồng biến</p></li>
</ul>
<p>Độ mạnh yếu của hệ số tương quan được đo lường bằng giá trị tuyệt đối:</p>
<ul class="simple">
<li><p>Lớn hơn 0.7: Mạnh</p></li>
<li><p>Từ 0.3-0.7: Trung bình</p></li>
<li><p>Dưới 0.3: Yếu</p></li>
</ul>
<p>Tính toán correlation như sau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Create a Polars DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span>
<span class="p">})</span>

<span class="c1"># Calculate correlation between columns &#39;x&#39; and &#39;y&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation (Pearson):&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation (Pearson): 0.7338691687538745
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lets_plot</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> 
<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <div id="zaF1pG"></div>
            <script type="text/javascript" data-lets-plot-script="library">
                if(!window.letsPlotCallQueue) {
                    window.letsPlotCallQueue = [];
                }; 
                window.letsPlotCall = function(f) {
                    window.letsPlotCallQueue.push(f);
                };
                (function() {
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.6.2/js-package/distr/lets-plot.min.js";
                    script.onload = function() {
                        window.letsPlotCall = function(f) {f();};
                        window.letsPlotCallQueue.forEach(function(f) {f();});
                        window.letsPlotCallQueue = [];
                        
                    };
                    script.onerror = function(event) {
                        window.letsPlotCall = function(f) {};    // noop
                        window.letsPlotCallQueue = [];
                        var div = document.createElement("div");
                        div.style.color = 'darkred';
                        div.textContent = 'Error loading Lets-Plot JS';
                        document.getElementById("zaF1pG").appendChild(div);
                    };
                    var e = document.getElementById("zaF1pG");
                    e.appendChild(script);
                })()
            </script>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;lm&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Correlation between x &amp; y: </span><span class="si">{</span><span class="n">correlation</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">   <div id="pr4bUL"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
   
   (function() {
   // ----------
   
   const forceImmediateRender = false;
   const responsive = false;
   
   let sizing = {
       width_mode: "MIN",
       height_mode: "SCALED",
       width: null, 
       height: null 
   };
   
   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;
   if (preferredWidth !== undefined) {
       sizing = {
           width_mode: 'FIXED',
           height_mode: 'SCALED',
           width: parseFloat(preferredWidth)
       };
   }
   
   const containerDiv = document.getElementById("pr4bUL");
   let fig = null;
   
   function renderPlot() {
       if (fig === null) {
           const plotSpec = {
"data":{
"x":[37.785764152584804,61.846741772658945,42.968383671058064,61.07996128199423,52.96438430415517,54.59103140776433,48.15716177009077,65.85757081283268,48.325852661331595,49.355599478583486,60.736567166218194,62.21802908455355,64.89182434668544,46.133515249377865,44.35952335280839,50.441398359838395,47.199119363980294,46.66354990691482,45.91631183364946,48.50096672408414,52.84110568027028,74.76139628891914,38.596777151644325,69.80110685220406,48.439930870373686,61.80726211355726,60.372475416415995,55.016041677901974,60.62410345611822,47.71234730902304,49.46161963652641,41.62284150654445,53.250370495928856,45.53980269310941,33.89340519514536,49.16192359385768,53.15579325076531,50.75937006515798,57.40097239962449,47.11405091839017,34.85948802738859,46.251625837687435,51.64448912457763,53.93521040650035,58.210542387292506,65.75803603198784,40.920230114496206,58.55735893106105,62.26845656682926,53.91852899205942,53.707461868397594,60.72791800521912,33.64957980587797,52.032379841557194,57.049320990558165,46.12393204555639,43.12354654136095,48.76331962875713,48.869452290413285,51.51308684919102,75.19682717729896,46.609554323340014,72.82341136067203,54.985818967723816,45.5303316302811,57.2841032496138,51.73458325135183,59.83384001721347,47.21641065618991,46.07545917010279,35.60703556825078,55.30205760911292,53.260732281028815,61.005057171195865,49.03973188176858,52.88456729644772,66.33748992666504,65.7828915156838,44.1116398511363,51.54553830911246,36.23100244506728,51.553114993490716,55.905617033127285,47.571268527557756,60.83964842930298,52.6967821604696,61.852884983185035,53.846093691534286,46.42703031955879,57.57418950562042,53.70912963339914,43.680576156189744,39.55499391548255,48.330740292422036,45.33395286172639,50.90341183707651,55.947347041706934,43.815075806424744,33.264708452389584,56.64393981336155],
"y":[94.7241695183806,170.26749542085363,152.68360808001225,129.3618510503846,114.55785989009794,114.85137724182769,93.67430455936412,151.22509250647005,154.7089692176458,138.02126904235888,166.63149474365372,167.77036594112025,157.2460832035534,118.32004151980416,55.11295568217039,107.30828100092448,106.47671188890013,155.421381095283,135.44133875182098,144.48002054485923,150.26925894132808,217.1014273739679,105.37556387765936,162.61424840007314,125.21073185530547,157.37721009380073,137.93451903474784,126.83829648621368,119.70201807703415,99.94582414183598,132.2161025183977,127.85017943496936,124.70692926974391,144.1108875610775,61.018360921198884,113.09867725408147,140.3745614635744,150.99425865105167,141.64745610023883,157.18914197259602,84.02321202730947,110.77040919518411,101.10729853409612,131.27046760295528,127.28364842557446,188.5866630308604,97.445531535726,169.69882931749532,163.2674152307944,152.433914065601,107.57838916345307,159.04686440831705,103.43424406480848,131.52746800511827,157.49987231276359,107.4892206623841,102.44805707693911,134.7859683664282,135.26603146896545,134.78661790133742,195.84580898153888,109.58196641363254,157.92520961757282,163.3742876018335,121.62818972106658,123.11663167126979,135.63198194524023,156.3874963172021,126.94334187457548,117.69056671085026,62.981400060573364,146.0033556105396,95.83509492673672,136.35900056327768,122.77968975016209,136.93713442999865,147.807525162654,158.24557304901109,87.24623131502142,164.8576460187692,84.16880573196678,107.49780310789941,186.8618797211626,89.23909051189159,150.71213990638748,162.1071096788573,123.164902018692,124.03714762155559,106.78209998666938,153.50679691552585,112.93676811116887,136.57420703546578,100.07394924150407,119.87500998499547,79.02967106334533,142.25835658856195,132.67995160057615,100.94268981469618,77.61923787138966,179.23776234983626]
},
"mapping":{
"x":"x",
"y":"y"
},
"data_meta":{
"series_annotations":[{
"type":"float",
"column":"x"
},{
"type":"float",
"column":"y"
}]
},
"ggtitle":{
"text":"Correlation between x & y: 0.73"
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"alpha":0.3,
"size":4.0,
"data":{
}
},{
"geom":"smooth",
"mapping":{
},
"data_meta":{
},
"method":"lm",
"color":"red",
"data":{
"..ymin..":[74.57942084442995,76.11609551206448,77.65155171797262,79.18569920695504,80.71843920861292,82.24966349833974,83.77925334712039,85.30707834792265,86.83299510585144,88.35684577895708,89.87845645683274,91.3976353651837,92.91417088677139,94.42782939302964,95.93835288688206,97.44545646670238,98.94882563502252,100.44811349478425,101.94293790212615,103.43287867944854,104.91747503723626,106.39622340874098,107.86857596787856,109.33394017523412,110.79167977419617,112.24111772848212,113.68154163707385,115.1122121596264,116.53237490618604,117.94127606011025,119.33818169068556,120.72240027062645,122.09330737612389,123.45037098968514,124.79317536542275,126.12144118771519,127.43503986988723,128.73400034290188,130.0185075165791,131.28889260052588,132.54561643671548,133.78924772137273,135.020438356493,136.23989815147388,137.44837076655818,138.64661227838343,139.83537318611772,141.01538416787264,142.1873455011998,143.3519197972287,144.50972755487714,145.66134499373376,146.80730364179112,147.94809121026444,149.0841533614337,150.21589605255977,151.34368821088606,152.46786455724217,153.58872844735941,154.70655464095034,155.82159194004964,156.9340656615679,158.04417992601878,159.15211975635083,160.2580529889535,161.3621320041962,162.46449528707382,163.56526883027317,164.66456739269069,165.76249562645782,166.85914908510827,167.9546151248264,169.04897370986816,170.14229813233197,171.2346556555291,172.3261080893028,173.41671230479068,174.50652069532964,175.5955815894746,176.68393962143924],
"..ymax..":[93.6476741791942,94.743564735337,95.84067375320616,96.93909148800111,98.03891671012053,99.14025764417104,100.2432330191677,101.3479732421428,102.45462170799132,103.56333625866301,104.67429080456472,105.78767711999106,106.90370682218071,108.02261353969979,109.1446552696247,110.27011691358169,111.39931296903892,112.53259033305451,113.67033114948993,114.81295559594487,115.96092446193448,117.1147413142071,118.27495397884682,119.44215499526862,120.61698062008391,121.80010788957526,122.99224920476084,124.19414390598565,125.40654638320335,126.63021045305643,127.8658700462585,129.11421669009493,130.3758748083748,131.65137641859087,132.94113726663065,134.2454366681155,135.56440320972078,136.89800796048348,138.24606601058363,139.60824615041415,140.98408753800186,142.37302147712197,143.774396065779,145.18750149457543,146.6115941032685,148.0459178152206,149.48972213126362,150.942276373286,152.40288026373622,153.8708711914846,155.34562865761347,156.82657644253416,158.31318301825416,159.8049606735582,161.30146374616626,162.80228627881755,164.30705934426857,165.81544822168976,167.32714955534988,168.84188858553625,170.35941651021432,171.87950801247337,173.40195897179984,174.9265843652451,176.4532163564198,177.9817025649544,179.5119045058541,181.0436961864321,182.5769628477919,184.11159983780212,185.64751160292897,187.1846107869882,188.72281742572375,190.26205822703724,191.80226592761747,193.34337871762108,194.88533972591057,196.42809655914897,197.97160088878132,199.51580808059398],
"x":[33.264708452389584,33.795494765363124,34.326281078336656,34.857067391310196,35.38785370428373,35.91864001725727,36.4494263302308,36.98021264320434,37.51099895617787,38.04178526915141,38.57257158212495,39.10335789509848,39.63414420807202,40.164930521045555,40.695716834019095,41.22650314699263,41.75728945996617,42.288075772939706,42.81886208591324,43.34964839888678,43.88043471186031,44.41122102483385,44.94200733780738,45.47279365078092,46.00357996375446,46.534366276727994,47.065152589701526,47.595938902675066,48.126725215648605,48.65751152862214,49.18829784159568,49.71908415456922,50.24987046754275,50.78065678051628,51.31144309348982,51.84222940646336,52.37301571943689,52.90380203241043,53.43458834538397,53.965374658357504,54.49616097133104,55.026947284304576,55.557733597278116,56.08851991025165,56.61930622322519,57.15009253619873,57.68087884917226,58.21166516214579,58.74245147511933,59.27323778809287,59.8040241010664,60.334810414039936,60.865596727013475,61.396383039987015,61.92716935296055,62.45795566593409,62.988741978907626,63.51952829188116,64.05031460485469,64.58110091782822,65.11188723080177,65.6426735437753,66.17345985674885,66.70424616972238,67.23503248269591,67.76581879566945,68.29660510864298,68.82739142161653,69.35817773459006,69.8889640475636,70.41975036053714,70.95053667351067,71.4813229864842,72.01210929945773,72.54289561243128,73.07368192540481,73.60446823837836,74.13525455135189,74.66604086432542,75.19682717729896],
"y":[84.11354751181207,85.42983012370074,86.74611273558939,88.06239534747807,89.37867795936673,90.6949605712554,92.01124318314405,93.32752579503273,94.64380840692138,95.96009101881005,97.27637363069873,98.59265624258738,99.90893885447605,101.22522146636472,102.54150407825338,103.85778669014204,105.17406930203072,106.49035191391938,107.80663452580804,109.1229171376967,110.43919974958537,111.75548236147404,113.07176497336269,114.38804758525137,115.70433019714004,117.02061280902869,118.33689542091734,119.65317803280603,120.96946064469469,122.28574325658334,123.60202586847203,124.9183084803607,126.23459109224935,127.55087370413801,128.8671563160267,130.18343892791535,131.499721539804,132.81600415169268,134.13228676358136,135.44856937547002,136.76485198735867,138.08113459924735,139.397417211136,140.71369982302465,142.02998243491334,143.34626504680202,144.66254765869067,145.97883027057932,147.295112882468,148.61139549435666,149.9276781062453,151.24396071813396,152.56024333002264,153.87652594191132,155.19280855379998,156.50909116568866,157.8253737775773,159.14165638946596,160.45793900135465,161.7742216132433,163.09050422513198,164.40678683702063,165.7230694489093,167.03935206079797,168.35563467268665,169.6719172845753,170.98819989646395,172.30448250835263,173.6207651202413,174.93704773212997,176.25333034401862,177.5696129559073,178.88589556779596,180.2021781796846,181.5184607915733,182.83474340346194,184.15102601535062,185.4673086272393,186.78359123912796,188.0998738510166]
}
}],
"metainfo_list":[],
"spec_id":"1"
};
           window.letsPlotCall(function() { fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing); });
       } else {
           fig.updateView({});
       }
   }
   
   const renderImmediately = 
       forceImmediateRender || (
           sizing.width_mode === 'FIXED' && 
           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')
       );
   
   if (renderImmediately) {
       renderPlot();
   }
   
   if (!renderImmediately || responsive) {
       // Set up observer for initial sizing or continuous monitoring
       var observer = new ResizeObserver(function(entries) {
           for (let entry of entries) {
               if (entry.contentBoxSize && 
                   entry.contentBoxSize[0].inlineSize > 0) {
                   if (!responsive && observer) {
                       observer.disconnect();
                       observer = null;
                   }
                   renderPlot();
                   if (!responsive) {
                       break;
                   }
               }
           }
       });
       
       observer.observe(containerDiv);
   }
   
   // ----------
   })();
   
   </script></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="rubric" id="id1">Lưu ý</p>
<ul class="simple">
<li><p>Hệ số tương quan chỉ mô tả mối quan hệ đồng biến hoặc nghịch biến giữa hai biến liên tục mà không phản ánh quan hệ phi tuyến tính giữa 2 biến</p></li>
<li><p>Hệ số tương quan không phản ánh được mối quan hệ nhân quả, hai biến có hệ số tương quan cao không có nghĩa là biến này gây ảnh hưởng đến biến kia (correlation vs causiality)</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Create a Polars DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
    <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span>
<span class="p">})</span>

<span class="c1"># Calculate correlation between columns &#39;x&#39; and &#39;y&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;lm&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Correlation between x &amp; y: </span><span class="si">{</span><span class="n">correlation</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">   <div id="cBKveh"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
   
   (function() {
   // ----------
   
   const forceImmediateRender = false;
   const responsive = false;
   
   let sizing = {
       width_mode: "MIN",
       height_mode: "SCALED",
       width: null, 
       height: null 
   };
   
   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;
   if (preferredWidth !== undefined) {
       sizing = {
           width_mode: 'FIXED',
           height_mode: 'SCALED',
           width: parseFloat(preferredWidth)
       };
   }
   
   const containerDiv = document.getElementById("cBKveh");
   let fig = null;
   
   function renderPlot() {
       if (fig === null) {
           const plotSpec = {
"data":{
"x":[8.271360023322883,4.958263970852124,3.6348868328490527,2.7560310276085875,9.247408135383717,3.8698923425629217,4.928808734313202,2.544381023144221,8.849665188380634,3.8326345680528675,2.9757471531387525,7.175949621947543,1.9086994317230743,1.1819262934703845,8.369977822135121,7.441359213695352,5.905205476471171,2.4289157496487066,6.23247145187584,6.38355320741173,3.2756944411232514,0.6748934306754228,8.805385975643267,4.599567310742584,7.638727180664299,2.538886209427397,5.913871822675168,4.287951603487977,3.8210064254913956,1.2671338384692277,2.4426666320897583,0.7934158295831895,3.0285830471757857,7.417048002315553,6.150157249710489,6.724110989339258,0.08383079525031589,6.783769722513199,5.031806905428871,2.309084504841792,1.7489650898192222,1.8498296555082983,8.442600050750984,9.825897893050854,9.137396248416316,3.473694203728128,7.802245796913637,5.4645459070143065,8.164423975559377,4.837269511889058,5.899512982994038,7.872634475242615,1.0023464310313235,5.370071168405407,3.6598334666965426,6.043068436688722,9.588025156370005,3.9282294499696246,3.929729979416164,7.906369935895988,6.450783990854264,3.9388400785537647,6.889550482302514,4.04001609054379,1.361131542481221,4.506432686721345,3.344193926972726,2.1796893006116793,9.257748016364399,6.896393990795577,5.988208906234219,7.46657472123005,5.419710617714415,7.005330726195026,9.30559819249845,8.62616694505222,1.674418575065213,2.6313902392387423,0.7161027944180454,9.78672805158347,2.3638409866037557,6.6059835592859875,0.89630698927462,2.1077094208701874,5.028243835184045,1.0495366832992803,3.888734026947244,5.379877201396809,3.3920418488509996,5.559002111265755,5.367683219424641,3.9061049873690576,6.96270083101103,6.78482453997924,6.873031493743898,5.614912587993742,3.580799140129358,6.131123353670123,9.357362666081997,5.968885249459731],
"y":[0.909641350700697,-0.9332324430899646,-0.4625626591152632,0.534890736286312,0.33202485394037023,-0.6453774862825965,-0.9695589914121225,0.4975303696231854,0.6000221394640723,-0.5244693240253696,0.20511199681874953,0.75749979510174,0.9965757601343684,1.0664855846526824,0.917618797375597,1.0043189414285383,-0.5854857675641826,0.6362942214012173,-0.17902648872139687,0.02389977425432091,-0.10930259546393462,0.6692554708078362,0.5769236519763548,-1.0381997998090597,1.0052984042364312,0.6071532567374002,-0.2540683522793636,-0.9726496767453119,-0.7477477718381301,0.8452516723566533,0.7064649843387896,0.7160405622694904,0.11743527348178538,1.0064504359093789,0.011544968237424014,0.339556409964781,0.30769256244738813,0.38551934113668235,-1.0138573321103665,0.7136387391697054,0.9956641547918829,0.8264422082405454,0.9641695237270551,-0.426971633159265,0.24832920532873812,-0.34083424546897656,0.903710171321061,-0.8661570279798093,0.9490554055552417,-0.9303460302539317,-0.3718848949816164,0.8195191592826452,0.7613937209934214,-0.7614150694140931,-0.43587154634737973,-0.1942020154376488,-0.2619813904803485,-0.9171073968838105,-0.7297139084300317,0.9685891150598529,0.19748499152298507,-0.6272048909782948,0.5086510774757947,-0.8967489009217084,0.9583954582883133,-1.099282287269353,-0.1395457200327469,0.7225228356382571,0.2687681765051714,0.5957606229284518,-0.22314372519824177,0.7927519794837784,-0.7582553050512318,0.6078329782019984,0.11832679856626857,0.6878596095834323,0.8564552400944974,0.5825625873154157,0.7178057058259432,-0.510184822879142,0.8513052452973269,0.22895894850441056,1.0109081104047781,0.8526026994602143,-1.084318639208123,0.7750891022914285,-0.6942352771825061,-0.7558042181567005,-0.20875375855727957,-0.8337904689490452,-0.8170443661577149,-0.823592761176067,0.6831150268390702,0.48013534463644586,0.5323464256484417,-0.3988877570595589,-0.2806346853863604,-0.03328935956072493,2.2656138382766422E-4,-0.3192312589349434]
},
"mapping":{
"x":"x",
"y":"y"
},
"data_meta":{
"series_annotations":[{
"type":"float",
"column":"x"
},{
"type":"float",
"column":"y"
}]
},
"ggtitle":{
"text":"Correlation between x & y: -0.05"
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"alpha":0.3,
"size":4.0,
"data":{
}
},{
"geom":"smooth",
"mapping":{
},
"data_meta":{
},
"method":"lm",
"color":"red",
"data":{
"..ymin..":[-0.108015848589398,-0.103982265882272,-0.09998065422876362,-0.09601299077722159,-0.09208140599388037,-0.08818819725635785,-0.0843358436898467,-0.08052702233880998,-0.0767646257651396,-0.07305178115822245,-0.06939187103186653,-0.0657885555658729,-0.06224579662410784,-0.05876788344360623,-0.055359459937342814,-0.05202555348302254,-0.04877160497708952,-0.045603499812047144,-0.0425275992805588,-0.039550771715907956,-0.036680422439874766,-0.03392452130177154,-0.031291626254656174,-0.02879090102936291,-0.026432124543524255,-0.024225689240669063,-0.022182585126579196,-0.020314365906002718,-0.01863309339160396,-0.01715125634758935,-0.015881660247995394,-0.01483728518609359,-0.014031110467865482,-0.013475906323203335,-0.013183995667690684,-0.013166991835672631,-0.01343552144212512,-0.013998944642867439,-0.014865087572364669,-0.01604000313541147,-0.017527776176202756,-0.019330387100496824,-0.021447644327161494,-0.0238771908636385,-0.026614584485480056,-0.029653445258444017,-0.03298565926238432,-0.03660162396684477,-0.04049051908170592,-0.04464058685035825,-0.04903940738062376,-0.05367415726138508,-0.05853184287914495,-0.06359950306523326,-0.06886437861986157,-0.07431404865788074,-0.07993653551364896,-0.08572038113796383,-0.09165469859147024,-0.09772920249097496,-0.1039342222094634,-0.11026070137016701,-0.11670018679530954,-0.12324480963669246,-0.1298872609745093,-0.13662076375292215,-0.1434390425434563,-0.15033629229835838,-0.15730714697752435,-0.16434664870227322,-0.17145021790265705,-0.17861362477667853,-0.18583296226398002,-0.19310462064779144,-0.20042526383216602,-0.20779180729246216,-0.21520139766192078,-0.2226513938929636,-0.23013934991599175,-0.2376629987089493],
"..ymax..":[0.4870920473751356,0.47950859203543705,0.4719571077493561,0.4644395716652415,0.45695811424932775,0.44951503287923267,0.44211280668014896,0.4347541126965397,0.42744184349029674,0.420179126250807,0.4129693434918785,0.4058161553933124,0.39872352381897475,0.3916957380059005,0.38473744186706454,0.37785366278017174,0.3710498416416661,0.3643318638440512,0.35770609067999026,0.3511793904827669,0.3447591685741611,0.33845339480348535,0.3322706271237974,0.32622002926593163,0.32031138014752036,0.31455507221209256,0.3089620954654302,0.3035440036122811,0.2983128584653098,0.2932811487887227,0.28846168005655615,0.2838674323620818,0.2795113850112811,0.2754063082340464,0.27156452494596117,0.26799764848137053,0.2647163054552505,0.26172985602342025,0.2590461263203449,0.2566711692508191,0.25460906965903785,0.25286180795075935,0.25142919254485147,0.25030886644875594,0.24949638743802494,0.2489853755784163,0.24876771694978406,0.24883380902167193,0.24917283150396052,0.2497730266400403,0.25062197453773327,0.251706851785922,0.25301466477110934,0.25453245232462507,0.2562474552466808,0.25814725265212746,0.26021986687532306,0.2624538398670654,0.26483828468799925,0.2673629159549314,0.27001806304084724,0.2727946695689783,0.2756842823615483,0.27867903257035864,0.2817716112756029,0.2849552414214432,0.2882236475794048,0.29157102470173424,0.2949920067483277,0.298481635840504,0.30203533240831526,0.30564886664976415,0.30931833150449317,0.313040117255732,0.316810887807534,0.3206275586352576,0.3244872763721436,0.32838739997061384,0.3323254833610695,0.3362992595214545],
"x":[0.08383079525031589,0.20714810028576575,0.3304654053212156,0.45378271035666545,0.5771000153921153,0.7004173204275652,0.823734625463015,0.9470519304984648,1.0703692355339147,1.1936865405693646,1.3170038456048145,1.4403211506402642,1.5636384556757141,1.686955760711164,1.8102730657466137,1.9335903707820636,2.0569076758175138,2.1802249808529632,2.3035422858884136,2.426859590923863,2.5501768959593134,2.673494200994763,2.7968115060302123,2.9201288110656627,3.043446116101112,3.1667634211365625,3.290080726172012,3.4133980312074623,3.536715336242912,3.6600326412783613,3.7833499463138116,3.906667251349261,4.029984556384711,4.153301861420161,4.276619166455611,4.399936471491061,4.523253776526511,4.6465710815619605,4.769888386597411,4.89320569163286,5.016522996668311,5.13984030170376,5.26315760673921,5.38647491177466,5.5097922168101094,5.63310952184556,5.756426826881009,5.87974413191646,6.003061436951909,6.1263787419873585,6.249696047022809,6.373013352058258,6.496330657093709,6.619647962129158,6.7429652671646085,6.866282572200058,6.9895998772355075,7.112917182270958,7.236234487306407,7.359551792341858,7.482869097377307,7.6061864024127575,7.729503707448207,7.852821012483657,7.976138317519107,8.099455622554556,8.222772927590006,8.346090232625457,8.469407537660906,8.592724842696356,8.716042147731805,8.839359452767257,8.962676757802706,9.085994062838155,9.209311367873605,9.332628672909054,9.455945977944506,9.579263282979955,9.702580588015405,9.825897893050854],
"y":[0.1895380993928688,0.18776316307658253,0.18598822676029625,0.18421329044400997,0.1824383541277237,0.1806634178114374,0.17888848149515113,0.17711354517886485,0.17533860886257857,0.1735636725462923,0.171788736230006,0.17001379991371973,0.16823886359743345,0.16646392728114714,0.16468899096486087,0.16291405464857459,0.1611391183322883,0.15936418201600203,0.15758924569971575,0.15581430938342947,0.1540393730671432,0.1522644367508569,0.15048950043457063,0.14871456411828435,0.14693962780199807,0.14516469148571176,0.1433897551694255,0.1416148188531392,0.13983988253685292,0.13806494622056667,0.13629000990428036,0.13451507358799408,0.1327401372717078,0.13096520095542152,0.12919026463913524,0.12741532832284896,0.12564039200656268,0.1238654556902764,0.12209051937399011,0.12031558305770383,0.11854064674141755,0.11676571042513127,0.11499077410884499,0.11321583779255871,0.11144090147627243,0.10966596515998614,0.10789102884369987,0.10611609252741358,0.1043411562111273,0.10256621989484103,0.10079128357855474,0.09901634726226846,0.09724141094598218,0.0954664746296959,0.09369153831340961,0.09191660199712334,0.09014166568083706,0.08836672936455077,0.0865917930482645,0.08481685673197821,0.08304192041569193,0.08126698409940565,0.07949204778311937,0.07771711146683308,0.0759421751505468,0.07416723883426053,0.07239230251797425,0.07061736620168794,0.06884242988540168,0.0670674935691154,0.06529255725282912,0.06351762093654281,0.06174268462025656,0.05996774830397028,0.058192811987684,0.05641787567139772,0.054642939355111414,0.052868003038825134,0.051093066722538855,0.0493181304062526]
}
}],
"metainfo_list":[],
"spec_id":"2"
};
           window.letsPlotCall(function() { fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing); });
       } else {
           fig.updateView({});
       }
   }
   
   const renderImmediately = 
       forceImmediateRender || (
           sizing.width_mode === 'FIXED' && 
           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')
       );
   
   if (renderImmediately) {
       renderPlot();
   }
   
   if (!renderImmediately || responsive) {
       // Set up observer for initial sizing or continuous monitoring
       var observer = new ResizeObserver(function(entries) {
           for (let entry of entries) {
               if (entry.contentBoxSize && 
                   entry.contentBoxSize[0].inlineSize > 0) {
                   if (!responsive && observer) {
                       observer.disconnect();
                       observer = null;
                   }
                   renderPlot();
                   if (!responsive) {
                       break;
                   }
               }
           }
       });
       
       observer.observe(containerDiv);
   }
   
   // ----------
   })();
   
   </script></div></div>
</div>
<p><strong>Correlation vs. Causiality</strong></p>
<p>Hai biến có hệ số tương quan rất cao nhưng hoàn toàn không có quan hệ trong thực tế</p>
<p><img alt="" src="_images/p02-05-correlation-causation.png" /></p>
<div class="docutils">
</div>
</section>
<section id="anova">
<h2><span class="section-number">10.3. </span>ANOVA<a class="headerlink" href="#anova" title="Link to this heading"></a></h2>
<p><strong>ANOVA</strong> viết tắt của từ <em>analysis of variance</em>, tức phân tích phương sai.
Phương pháp ANOVA được sử dụng khi chúng ta muốn so sánh giữa 2 hoặc nhiều nhóm đối tượng khác nhau dựa vào 1 tiêu chí nhất định nào đó, ví dụ như so sánh <em>độ tuổi của nhóm khách hàng thường và khách VIP</em>, hay so sánh <em>thu nhập của nhóm khách hàng nam và khách hàng nữ</em>... Để giải thích một cách dễ hiểu hơn, chúng ta sẽ làm ví dụ sau với tập dữ liệu <code class="docutils literal notranslate"><span class="pre">iris</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;iris&quot;</span><span class="p">))</span>
<span class="n">iris</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>sepal_length</th><th>sepal_width</th><th>petal_length</th><th>petal_width</th><th>species</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>str</td></tr></thead><tbody><tr><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>&quot;setosa&quot;</td></tr><tr><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>&quot;setosa&quot;</td></tr><tr><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>&quot;setosa&quot;</td></tr><tr><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>&quot;setosa&quot;</td></tr><tr><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>&quot;setosa&quot;</td></tr></tbody></table></div></div></div>
</div>
<p>Chúng ta sẽ vẽ biểu đồ boxplot so sánh <code class="docutils literal notranslate"><span class="pre">Sepal.Length</span></code> giữa các loài hoa (<code class="docutils literal notranslate"><span class="pre">Species</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="s2">&quot;sepal_length&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s2">&quot;species&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Overview of Iris Sepal Length by Species&quot;</span><span class="p">,</span> 
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Species&quot;</span><span class="p">,</span>                                          
        <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Sepal Length (cm)&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">   <div id="0Y69Lc"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
   
   (function() {
   // ----------
   
   const forceImmediateRender = false;
   const responsive = false;
   
   let sizing = {
       width_mode: "MIN",
       height_mode: "SCALED",
       width: null, 
       height: null 
   };
   
   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;
   if (preferredWidth !== undefined) {
       sizing = {
           width_mode: 'FIXED',
           height_mode: 'SCALED',
           width: parseFloat(preferredWidth)
       };
   }
   
   const containerDiv = document.getElementById("0Y69Lc");
   let fig = null;
   
   function renderPlot() {
       if (fig === null) {
           const plotSpec = {
"data":{
},
"mapping":{
"x":"species",
"y":"sepal_length",
"fill":"species"
},
"data_meta":{
"series_annotations":[{
"type":"float",
"column":"sepal_length"
},{
"type":"float",
"column":"sepal_width"
},{
"type":"float",
"column":"petal_length"
},{
"type":"float",
"column":"petal_width"
},{
"type":"str",
"column":"species"
}]
},
"ggtitle":{
"text":"Overview of Iris Sepal Length by Species"
},
"guides":{
"x":{
"title":"Species"
},
"y":{
"title":"Sepal Length (cm)"
}
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"boxplot",
"mapping":{
},
"data_meta":{
},
"data":{
"..middle..":[5.0,5.9,6.5],
"..lower..":[4.8,5.6,6.25],
"..upper..":[5.2,6.3,6.9],
"..ymin..":[4.3,4.9,5.6],
"..ymax..":[5.8,7.0,7.7],
"species":["setosa","versicolor","virginica"]
}
},{
"geom":"point",
"stat":"boxplot_outlier",
"mapping":{
},
"show_legend":false,
"data_meta":{
},
"data":{
"..middle..":[5.0,5.9,6.5,6.5],
"..lower..":[4.8,5.6,6.25,6.25],
"..upper..":[5.2,6.3,6.9,6.9],
"..ymin..":[4.3,4.9,5.6,5.6],
"..ymax..":[5.8,7.0,7.7,7.7],
"species":["setosa","versicolor","virginica","virginica"],
"sepal_length":[NaN,NaN,4.9,7.9]
}
}],
"metainfo_list":[],
"spec_id":"3"
};
           window.letsPlotCall(function() { fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing); });
       } else {
           fig.updateView({});
       }
   }
   
   const renderImmediately = 
       forceImmediateRender || (
           sizing.width_mode === 'FIXED' && 
           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')
       );
   
   if (renderImmediately) {
       renderPlot();
   }
   
   if (!renderImmediately || responsive) {
       // Set up observer for initial sizing or continuous monitoring
       var observer = new ResizeObserver(function(entries) {
           for (let entry of entries) {
               if (entry.contentBoxSize && 
                   entry.contentBoxSize[0].inlineSize > 0) {
                   if (!responsive && observer) {
                       observer.disconnect();
                       observer = null;
                   }
                   renderPlot();
                   if (!responsive) {
                       break;
                   }
               }
           }
       });
       
       observer.observe(containerDiv);
   }
   
   // ----------
   })();
   
   </script></div></div>
</div>
<p>Kiểm định ANOVA sẽ giúp chung ta so sánh chiều dài đài hoa trung bình giữa các loài hoa, sau đó tính toán chênh lệch chiều dài đài hoa trung bình giữa các loài hoa, và cuối cùng sẽ kiểm định xem những sự chênh lệch đó thực sự có ý nghĩa về mặt thống kê hay không. Hay nói cách khác, phương pháp ANOVA kiểm định cặp giả thuyết sau:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: Không có sự khác biệt giữa chiều dài đài hoa của các loài hoa (tức chênh lệch chiều dài đài hoa trung bình  = 0)</p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: Có sự khác biệt giữa chiều dài đài hoa của các loài hoa (chênh lệch chiều dài đài hoa trung bình khác 0)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ols</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_tukeyhsd</span>

<span class="c1"># One-way ANOVA</span>
<span class="n">tukey</span> <span class="o">=</span> <span class="n">pairwise_tukeyhsd</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">iris</span><span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">],</span>    <span class="c1"># dependent variable</span>
                          <span class="n">groups</span><span class="o">=</span><span class="n">iris</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span>        <span class="c1"># group variable</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>                  <span class="c1"># significance level</span>

<span class="c1"># Print result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukey</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Multiple Comparison of Means - Tukey HSD, FWER=0.05   
=========================================================
  group1     group2   meandiff p-adj lower  upper  reject
---------------------------------------------------------
    setosa versicolor     0.93   0.0 0.6862 1.1738   True
    setosa  virginica    1.582   0.0 1.3382 1.8258   True
versicolor  virginica    0.652   0.0 0.4082 0.8958   True
---------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>Với kết quả như trên, ta hiểu như sau:</p>
<ul class="simple">
<li><p>Kết quả trong trường hợp này cho ta thấy thực sự có sự khác biệt giữa chiều dài đài hoa của các loài hoa (các giá trị p-value = 0).</p></li>
<li><p>Trung bình đài hòa của nhóm <code class="docutils literal notranslate"><span class="pre">vesicolor</span></code> cao hơn <code class="docutils literal notranslate"><span class="pre">setosa</span></code> là 0.93 (ước lượng điểm). Hoặc có thể nói đài hoa của nhóm <code class="docutils literal notranslate"><span class="pre">vesicolor</span></code> dài hơn <code class="docutils literal notranslate"><span class="pre">setosa</span></code> trong khoảng từ 0.686 đến 1.173 (từ <code class="docutils literal notranslate"><span class="pre">lwr</span></code> đến <code class="docutils literal notranslate"><span class="pre">upr</span></code>)</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p class="rubric" id="id2">Lưu ý</p>
<ul class="simple">
<li><p>Kỹ thuật phân tích ANOVA là kỹ thuật rất quan trọng và được phần lớn trong các bước phân tích khám phá.</p></li>
<li><p>Bên cạnh phân tich ANOVA về giá trị trung bình, cần lưu ý sử dụng <strong>giá trị trung bình sau khi loại bỏ outlier</strong> để bổ trợ</p></li>
</ul>
</div>
</section>
<section id="kiem-dinh-quan-he-chi-binh-phuong">
<h2><span class="section-number">10.4. </span>Kiểm định quan hệ Chi-bình phương<a class="headerlink" href="#kiem-dinh-quan-he-chi-binh-phuong" title="Link to this heading"></a></h2>
<p>Một trong những câu hỏi ta thường xuyên phải giải quyết trong quá trình phân tích dữ liệu là tìm kiếm mối quan hệ giữa các biến rời rạc. Một trong những kỹ thuật phổ biến để tìm kiếm mối quan hệ này là sử dụng kiểm định Chi-square (Khi bình phương).</p>
<p>Để thực hiện phân tích mối quan hệ này, ta cần thực hiện ba bước:</p>
<ul class="simple">
<li><p><strong>Bước một</strong>, xây dựng bảng phân phối tần xuất hai chiều.</p></li>
<li><p><strong>Bước hai</strong>, tính toán chỉ số <span class="math notranslate nohighlight">\(\chi^2\)</span> để kiểm định giả thuyết độc lập giữa hai biến</p></li>
<li><p><strong>Bước ba</strong>, đưa ra kết luận về mối quan hệ vừa được kiểm định</p></li>
</ul>
<p>Để hiểu hơn về kiểm định <span class="math notranslate nohighlight">\(\chi^2\)</span>, ta xem xét ví dụ dưới đây.</p>
<p><strong>Ví dụ</strong>: Một trang web quảng cáo muốn phân tích về mối quan hệ giữa <strong>phương thức quảng cáo</strong> và <strong>thiết bị sử dụng</strong>. Dữ liệu trong một tháng về số lượt người dùng truy cập website được thể hiện như bảng dưới đây (đơn vị <em>nghìn user</em>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;device_category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Desktop&quot;</span><span class="p">,</span> <span class="s2">&quot;Tablet&quot;</span><span class="p">,</span> <span class="s2">&quot;Phone&quot;</span><span class="p">,</span> <span class="s2">&quot;Total&quot;</span><span class="p">],</span>
    <span class="s2">&quot;organic_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
    <span class="s2">&quot;paid_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">65</span><span class="p">],</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
    <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">85</span><span class="p">],</span>
    <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Show the DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (4, 6)
┌─────────────────┬────────────────┬─────────────┬───────┬─────────┬───────┐
│ device_category ┆ organic_search ┆ paid_search ┆ email ┆ display ┆ total │
│ ---             ┆ ---            ┆ ---         ┆ ---   ┆ ---     ┆ ---   │
│ str             ┆ i64            ┆ i64         ┆ i64   ┆ i64     ┆ i64   │
╞═════════════════╪════════════════╪═════════════╪═══════╪═════════╪═══════╡
│ Desktop         ┆ 25             ┆ 20          ┆ 35    ┆ 20      ┆ 100   │
│ Tablet          ┆ 20             ┆ 30          ┆ 25    ┆ 25      ┆ 100   │
│ Phone           ┆ 35             ┆ 15          ┆ 10    ┆ 40      ┆ 100   │
│ Total           ┆ 80             ┆ 65          ┆ 80    ┆ 85      ┆ 300   │
└─────────────────┴────────────────┴─────────────┴───────┴─────────┴───────┘
</pre></div>
</div>
</div>
</div>
<p>Để phân tích mối quan hệ giữa hai biến, ta có giả thuyết như sau:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: Phương thức quảng cáo và thiết bị sử dụng không có mối liên hệ với nhau (hai biến độc lập)</p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: Phương thức quảng cáo và thiết bị sử dụng có mối liên hệ với nhau (tồn tại mối quan hệ giữa hai biến)</p></li>
</ul>
<p>Chỉ số <span class="math notranslate nohighlight">\(\chi^2\)</span> được tính như sau:</p>
<div class="math notranslate nohighlight">
\[\chi^2 = \sum\frac{(O_i - E_i)^2}{E_i}\]</div>
<p>Trong đó:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(O\)</span> là giá trị quan sát được thực tế (ví dụ: Desktop/Organic Search có 25 ngàn user)</p></li>
<li><p><span class="math notranslate nohighlight">\(E\)</span> là giá trị kỳ vọng của mỗi cặp giá trị.</p></li>
</ul>
<p>Ta tính giá trị <em>kỳ vọng</em> như sau:</p>
<ul class="simple">
<li><p>Tính tổng từng cột và từng dòng (giá trị  &quot; <em>Total</em> &quot;)</p></li>
<li><p>Nhân từng dòng với từng hàng và chia cho tổng số quan sát</p></li>
</ul>
<p><strong>Ví dụ</strong>: Giá trị kỳ vọng của <em>Desktop</em> và <em>Organic Search</em> có thể được tính như sau:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\text{Users}_{expected} &amp;= \frac{r_1}{T} \times \frac{c_1}{T} \times T \\
&amp;= \frac{100}{300} \times \frac{80}{300} \times 300 \\
&amp;= .33 \times .27 \times 300 \\
&amp;= 26.67 \\
&amp;= 27
\end{aligned}
\end{split}\]</div>
<p>Giá trị kỳ vọng của tất cả các giá trị có kết quả như sau</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;device_category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Desktop&quot;</span><span class="p">,</span> <span class="s2">&quot;Tablet&quot;</span><span class="p">,</span> <span class="s2">&quot;Phone&quot;</span><span class="p">],</span>
    <span class="s2">&quot;organic_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">26.67</span><span class="p">,</span> <span class="mf">26.67</span><span class="p">,</span> <span class="mf">26.67</span><span class="p">],</span>
    <span class="s2">&quot;paid_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">21.67</span><span class="p">,</span> <span class="mf">21.67</span><span class="p">,</span> <span class="mf">21.67</span><span class="p">],</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">23.33</span><span class="p">,</span> <span class="mf">23.33</span><span class="p">,</span> <span class="mf">23.33</span><span class="p">],</span>
    <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">28.33</span><span class="p">,</span> <span class="mf">28.33</span><span class="p">,</span> <span class="mf">28.33</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Show the DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape: (3, 5)
┌─────────────────┬────────────────┬─────────────┬───────┬─────────┐
│ device_category ┆ organic_search ┆ paid_search ┆ email ┆ display │
│ ---             ┆ ---            ┆ ---         ┆ ---   ┆ ---     │
│ str             ┆ f64            ┆ f64         ┆ f64   ┆ f64     │
╞═════════════════╪════════════════╪═════════════╪═══════╪═════════╡
│ Desktop         ┆ 26.67          ┆ 21.67       ┆ 23.33 ┆ 28.33   │
│ Tablet          ┆ 26.67          ┆ 21.67       ┆ 23.33 ┆ 28.33   │
│ Phone           ┆ 26.67          ┆ 21.67       ┆ 23.33 ┆ 28.33   │
└─────────────────┴────────────────┴─────────────┴───────┴─────────┘
</pre></div>
</div>
</div>
</div>
<p>Tiếp đó, ta tính toán sự khác biệt giữa giá trị kỳ vọng và giá trị thực tế. Sau đó tính <span class="math notranslate nohighlight">\(\chi^2\)</span> như sau:</p>
<ul class="simple">
<li><p>Tính độ sai lệch</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\text{Difference}&amp;= \text{User}_o - \text{User}_e \\
&amp;= 25 - 26.67 \\
&amp;= -1.67
\end{aligned}
\end{split}\]</div>
<ul class="simple">
<li><p>Tính giá trị bình phương</p></li>
</ul>
<div class="math notranslate nohighlight">
\[-1.67^2=2.78\]</div>
<ul class="simple">
<li><p>Chia giá trị vừa tính được cho giá trị kỳ vọng:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{2.78}{27} = 0.10\]</div>
<p>Tương tự, ta tính được cho tất cả các biến như sau</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;device_category&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Desktop&quot;</span><span class="p">,</span> <span class="s2">&quot;Tablet&quot;</span><span class="p">,</span> <span class="s2">&quot;Phone&quot;</span><span class="p">],</span>
                 <span class="s2">&quot;organic_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.67</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">],</span>
                 <span class="s2">&quot;paid_search&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">],</span>
                 <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.83</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">7.62</span><span class="p">],</span>
                 <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.45</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">]</span>
                 <span class="p">})</span>
<span class="n">df3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small><table border="1" class="dataframe"><thead><tr><th>device_category</th><th>organic_search</th><th>paid_search</th><th>email</th><th>display</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Desktop&quot;</td><td>0.1</td><td>0.13</td><td>5.83</td><td>2.45</td></tr><tr><td>&quot;Tablet&quot;</td><td>1.67</td><td>3.2</td><td>0.12</td><td>0.39</td></tr><tr><td>&quot;Phone&quot;</td><td>2.6</td><td>2.05</td><td>7.62</td><td>4.8</td></tr></tbody></table></div></div></div>
</div>
<p><span class="math notranslate nohighlight">\(\chi^2\)</span> thực tế được tính bằng tổng các giá trị trên <span class="math notranslate nohighlight">\(\chi^2 = 30.96\)</span></p>
<p>Với dữ liệu trên, ta có 4 cột và 3 hàng. Như vậy, bậc tự do trong phân phôi <span class="math notranslate nohighlight">\(\chi^2\)</span> là <span class="math notranslate nohighlight">\((4-1)*(3-1) = 6\)</span>. Ta có thể so sánh giá trị vừa tìm được với giá trị <span class="math notranslate nohighlight">\(\chi^2\)</span> tại
<a class="reference external" href="http://www.danielsoper.com/statcalc/calculator.aspx?id=12">đây</a>. Với <span class="math notranslate nohighlight">\(\alpha\)</span> bằng .1 và 6 bậc tự do, giá trị của <span class="math notranslate nohighlight">\(\chi\)</span>^2^ là 10.64. Với giá trị thực tế lớn hơn giá trị lý thuyết, ta bác bỏ <span class="math notranslate nohighlight">\(H_0\)</span>. Như vậy, về mặt thống kê, tồn tại mối quan hệ giữa phương thức marketing và thiết bị sử dụng.</p>
<p><strong>Ví dụ với Python</strong></p>
<p>Trong thực tế, khi phân tích dữ liệu, ta có thể ra quyết định nhanh chóng về mối quan hệ giữa hai biến rời rạc thông qua <code class="docutils literal notranslate"><span class="pre">p-value</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">chi2_contingency</span>
<span class="n">df_chisq</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;device_category&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Total&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;organic_search&quot;</span><span class="p">,</span> <span class="s2">&quot;paid_search&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;display&quot;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span><span class="n">df_chisq</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span> <span class="c1"># Expected Value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.5594473044479567e-05
[[26.66666667 21.66666667 23.33333333 28.33333333]
 [26.66666667 21.66666667 23.33333333 28.33333333]
 [26.66666667 21.66666667 23.33333333 28.33333333]]
</pre></div>
</div>
</div>
</div>
<p>Với <span class="math notranslate nohighlight">\(p-value &lt; 0.05\)</span>, ta bác bỏ <span class="math notranslate nohighlight">\(H_0\)</span>, chấp nhận <span class="math notranslate nohighlight">\(H_1\)</span>. Nghĩa là tồn tại mối quan hệ giữa phương thức quảng cáo và thiết bị sử dụng.</p>
</section>
<section id="prop-test">
<h2><span class="section-number">10.5. </span>Prop test<a class="headerlink" href="#prop-test" title="Link to this heading"></a></h2>
<p>Nếu Anova được sử dụng để đánh giá ảnh hưởng của 1 biến rời rạc lên 1 biến liên tục, prop test là một trường hợp đặc biệt của <span class="math notranslate nohighlight">\(\chi^2\)</span> dùng để đánh giá ảnh hưởng của 1 biến rời rạc lên phân bổ của 1 biến khác.</p>
<p>Ví dụ: Thử nghiệm đánh giá khả năng phản hồi của 2 thông điệp quảng cáo đến các nhóm đối tượng tương tự nhau.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Quảng cáo</p></th>
<th class="head"><p>Số lượt xem</p></th>
<th class="head"><p>Số lượt click</p></th>
<th class="head"><p>Tỷ lệ CR</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>1000</p></td>
<td><p>20</p></td>
<td><p>2%</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>900</p></td>
<td><p>16</p></td>
<td><p>1.8%</p></td>
</tr>
</tbody>
</table>
<p>Để đánh giá chính xác quảng cáo A có thực sự tốt hơn B hay không, ta có test sau.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.proportion</span><span class="w"> </span><span class="kn">import</span> <span class="n">proportions_ztest</span>

<span class="c1"># Two groups: 30/100 and 50/120</span>
<span class="n">nobs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">900</span><span class="p">]</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>

<span class="n">stat</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">nobs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Z statistic: </span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value: </span><span class="si">{</span><span class="n">pval</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Z statistic: 0.35
P-value: 0.7228
</pre></div>
</div>
</div>
</div>
<p>Trong trường hợp trên, ta không đủ kết luận rằng quảng cáo A tốt hơn quảng cáo B do <span class="math notranslate nohighlight">\(\text{p-value} &gt; 0.05\)</span></p>
<p><strong>Lưu ý</strong>: <code class="docutils literal notranslate"><span class="pre">prop.test</span></code> chỉ được dùng khi đo lường tỷ lệ chuyển đổi, ảnh hưởng của các biến rời rạc (factor) lên đối tượng (<code class="docutils literal notranslate"><span class="pre">discrete</span> <span class="pre">number</span></code>). Do đó, nếu dùng prop.test để đánh giá trên biến giá trị, đặc biệt sau khi chuyển đổi đơn vị tiền tệ sẽ gây ra các nhận định sai lầm.</p>
<p>VD: Đánh giá về tỷ lệ bảo hiểm tái tục năm 2 nếu khách hàng buộc phải mua bảo hiểm (không phải do tự nguyện), ta có bảng sau</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Tiêu chí</p></th>
<th class="head"><p>Bắt buộc</p></th>
<th class="head"><p>Không bắt buộc</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Số lượng hợp đồng (A)</p></td>
<td><p>2000</p></td>
<td><p>3000</p></td>
</tr>
<tr class="row-odd"><td><p>Giá trị 1 hợp đồng (B)</p></td>
<td><p>20 (M)</p></td>
<td><p>20 (M)</p></td>
</tr>
<tr class="row-even"><td><p>Tổng giá trị (C=A*B)</p></td>
<td><p>40 (B)</p></td>
<td><p>60 (B)</p></td>
</tr>
<tr class="row-odd"><td><p>Giá trị huỷ năm 2 (D)</p></td>
<td><p>18 (B)</p></td>
<td><p>22 (B)</p></td>
</tr>
<tr class="row-even"><td><p>Tỷ lệ huỷ (E= D/C)</p></td>
<td><p>45%</p></td>
<td><p>36.7%</p></td>
</tr>
</tbody>
</table>
<p>Bước tiếp theo, ta dùng <code class="docutils literal notranslate"><span class="pre">proportion</span> <span class="pre">test</span></code> để đánh giá hiệu ứng thực sự của việc bắt buộc phải mua bảo hiểm đến tỷ lệ huỷ năm 2.</p>
<p>Nếu dùng giá trị là tỷ đồng, ta có kết quả sau.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">huy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
<span class="n">total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span><span class="n">huy</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value is: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value is: 0.405
</pre></div>
</div>
</div>
</div>
<p>Kết quả cho thấy <span class="math notranslate nohighlight">\(p-value &gt; 0.05\)</span>, việc bắt buộc mua bảo hiểm không ảnh hưởng đến tỷ lệ huỷ năm 2!</p>
<p>Đây là kết quả sai lầm do bị đi nhầm vào bản chất. Do mỗi hợp đồng trị giá trung bình 20 triêu VND, kết quả đúng phải như sau.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">huy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">1100</span><span class="p">]</span>
<span class="n">total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">]</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span><span class="n">huy</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value is: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value is: 0.000
</pre></div>
</div>
</div>
</div>
<p>Kết quả sau cho thấy việc bắt buộc mua bảo hiểm làm tỷ lệ huỷ năm 2 cao hơn 9% so với năm đầu.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="rubric" id="id3">Lưu ý</p>
<p>Khi dùng proportion test, cần lưu ý đến đơn vị của các chỉ số. Nếu không sẽ rất dễ mắc phải và xảy ra sai lầm khi ra quyết định.</p>
</div>
</section>
<section id="simpson-paradox">
<h2><span class="section-number">10.6. </span>Simpson paradox<a class="headerlink" href="#simpson-paradox" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Simpson</span> <span class="pre">paradox</span></code> là hiện tượng xảy ra khi xu hướng/ kết luận tổng thể lại khác biệt so với khi so sánh từ nhóm riêng biệt.</p>
<p><img alt="" src="_images/simpson-paradox.png" /></p>
<p>Xem ví dụ sau - Có khảo sát nghiên cứu thị trường về tỷ lệ quan tâm đến uống trà sữa buổi trưa. Kết quả như sau</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Nhóm</strong></p></th>
<th class="head"><p><strong>Nam</strong></p></th>
<th class="head"><p><strong>Tỷ lệ</strong></p></th>
<th class="head"><p><strong>Nữ</strong></p></th>
<th class="head"><p><strong>Tỷ lệ</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Dưới 30 tuổi</p></td>
<td><p>630/900</p></td>
<td><p><strong>70%</strong></p></td>
<td><p>80/100</p></td>
<td><p><strong>80%</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Trên 30 tuổi</p></td>
<td><p>40/100</p></td>
<td><p><strong>40%</strong></p></td>
<td><p>450/900</p></td>
<td><p><strong>50%</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>Tổng số</strong></p></td>
<td><p><strong>670/1000</strong></p></td>
<td><p><strong>67%</strong></p></td>
<td><p><strong>530/1000</strong></p></td>
<td><p><strong>53%</strong></p></td>
</tr>
</tbody>
</table>
<p>Khi quan sát riêng lẻ từng phân khúc, ta thấy kết quả như sau:</p>
<ul class="simple">
<li><p><strong>Với nhóm dưới 30 tuổi</strong> - Nữ quan tâm nhiều hơn nam (80% &gt; 70%)</p></li>
<li><p><strong>Với nhóm trên 30 tuổi</strong> - Nữ quan tâm nhiều hơn nam (50% &gt; 40%)</p></li>
</ul>
<p><strong>Kết luận</strong>: Nữ quan tâm đến việc uống trà sữa nhiều hơn nam.</p>
<p>Tuy nhiên, khi phân tích tổng thể, kết quả ra ngược lại - nam giới lại quan tâm nhiều hơn nữ giời (67% &gt; 53%). Hiện tượng trên gọi là Simpson paradox.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p class="rubric" id="id4">Lưu ý</p>
<p>Simpson paradox là phương pháp bẻ nhỏ dữ liệu và dùng phương pháp suy diễn - nếu xu hướng là đúng với tất cả tập con, sẽ đúng với tổng thể. Do đó, khi phân tích cần đặc biệt cẩn thận để tránh đi vào ngụy biện</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="p01-09-numpy.html" class="btn btn-neutral float-left" title="9. Numpy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="p01-11-map-folium.html" class="btn btn-neutral float-right" title="11. Bản đồ với folium" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Anh Hoang Duc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>