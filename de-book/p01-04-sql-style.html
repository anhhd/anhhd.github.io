
<!DOCTYPE html>


<html lang="vn" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. SQL style guide &#8212; Data Engineer</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=0cebd926" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=f2f0b1f9"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'p01-04-sql-style';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Mẹo với SQL" href="p01-05-tricks-sql.html" />
    <link rel="prev" title="3. SQL tuning" href="p01-03-sql-tuning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="vn"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Engineer</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Kiến thức cơ bản với MSSQL Server</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html">1. SQL cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-02-sql-nang-cao.html">2. SQL nâng cao</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-03-sql-tuning.html">3. SQL tuning</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. SQL style guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-05-tricks-sql.html">5. Mẹo với SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-06-sqlcmd.html">6. SQLCMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-07-sql-project.html">7. SQL prọject</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-08-sql-va-excel.html">8. Kết nối SQL với Excel phục vụ báo cáo tự động</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SQL style guide</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Mục lục </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#viet-thuong-cau-lenh">4.1. Viết thường câu lệnh</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select">4.2. Mỗi cột cần được tách thành các dòng khác nhau trong select</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-dieu-kien-trong-where-can-viet-lui-vao-trong">4.3. Các điều kiện trong where cần viết lùi vào trong</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#can-trai-cac-keyword-chinh">4.4. Căn trái các keyword chính</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#khoang-trang-trong-dau-ngoac">4.5. Khoảng trắng trong dấu ngoặc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tach-dong-trong-dieu-kien-in-nhieu-gia-tri">4.6. Tách dòng trong điều kiện in nhiều giá trị</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ten-cac-bang-va-cot">4.7. Tên các bảng và cột</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-luu-y-format-khi-join">4.8. Các lưu ý format khi join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-cot-duoc-group-duoc-day-len-truoc">4.9. Các cột được group được đẩy lên trước</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-when">4.10. Case when</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dung-bang-ao-cte">4.11. Dùng bảng ảo CTE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tai-lieu-tham-khao">4.12. Tài liệu tham khảo</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sql-style-guide">
<h1><span class="section-number">4. </span>SQL style guide<a class="headerlink" href="#sql-style-guide" title="Link to this heading">#</a></h1>
<p>Việc viết chuẩn format code của bất kỳ ngôn ngữ nào đều rất quan trọng, sẽ giúp cho việc theo dõi và đọc code thuận tiện hơn rất nhiều. Các lưu ý khi viết format code SQL</p>
<section id="viet-thuong-cau-lenh">
<h2><span class="section-number">4.1. </span>Viết thường câu lệnh<a class="headerlink" href="#viet-thuong-cau-lenh" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">Select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">From</span><span class="w"> </span><span class="n">users</span>
</pre></div>
</div>
</section>
<section id="moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select">
<h2><span class="section-number">4.2. </span>Mỗi cột cần được tách thành các dòng khác nhau trong select<a class="headerlink" href="#moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">email</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">name</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="cac-dieu-kien-trong-where-can-viet-lui-vao-trong">
<h2><span class="section-number">4.3. </span>Các điều kiện trong where cần viết lùi vào trong<a class="headerlink" href="#cac-dieu-kien-trong-where-can-viet-lui-vao-trong" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;example@domain.com&#39;</span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;example@domain.com&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>
</pre></div>
</div>
</section>
<section id="can-trai-cac-keyword-chinh">
<h2><span class="section-number">4.4. </span>Căn trái các keyword chính<a class="headerlink" href="#can-trai-cac-keyword-chinh" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">  </span><span class="n">column_name1</span><span class="p">,</span>
<span class="w">  </span><span class="n">column_name2</span><span class="p">,</span>
<span class="w">  </span><span class="n">column_name3</span>
<span class="k">from</span><span class="w"> </span><span class="n">table_1</span>
<span class="k">join</span><span class="w"> </span><span class="n">table_2</span>
<span class="w">  </span><span class="k">on</span><span class="w"> </span><span class="n">table_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table_2</span><span class="p">.</span><span class="n">id</span>
<span class="k">where</span><span class="w"> </span><span class="n">clouds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">gem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="k">having</span><span class="w"> </span><span class="n">column_name1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">column_name2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="khoang-trang-trong-dau-ngoac">
<h2><span class="section-number">4.5. </span>Khoảng trắng trong dấu ngoặc<a class="headerlink" href="#khoang-trang-trong-dau-ngoac" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tach-dong-trong-dieu-kien-in-nhieu-gia-tri">
<h2><span class="section-number">4.6. </span>Tách dòng trong điều kiện in nhiều giá trị<a class="headerlink" href="#tach-dong-trong-dieu-kien-in-nhieu-gia-tri" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;user-1@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-2@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-3@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-4@example.com&#39;</span>
<span class="w">    </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ten-cac-bang-va-cot">
<h2><span class="section-number">4.7. </span>Tên các bảng và cột<a class="headerlink" href="#ten-cac-bang-va-cot" title="Link to this heading">#</a></h2>
<p>Vì các bảng và cột thường đặt tên tiếng anh nên với các tên bảng/cột đặt tiếng anh nên các lưu ý như sau:</p>
<ul class="simple">
<li><p>viêt thường</p></li>
<li><p>Bảng đặt tên có dấu</p></li>
<li><p>Cột đặt tên không dấu</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">visit_logs</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="k">user</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">visitLog</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_month</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">SignupMonth</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
</pre></div>
</div>
</section>
<section id="cac-luu-y-format-khi-join">
<h2><span class="section-number">4.8. </span>Các lưu ý format khi join<a class="headerlink" href="#cac-luu-y-format-khi-join" title="Link to this heading">#</a></h2>
<p>Đặt điều kiện join theo thứ tự bảng</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span>
<span class="c1">-- primary_key = foreign_key --&gt; one-to-many --&gt; fanout</span>
<span class="w">  </span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">charges</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
<span class="c1">-- foreign_key = primary_key --&gt; many-to-one --&gt; no fanout</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
<center><font size=4>&sect;</font></center>
<p>Khi join nhiều điều kiện, cần phân tách điều kiện theo các dòng khác nhau</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">charges</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_revenue</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">and</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">account</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">email</span>
</pre></div>
</div>
<center><font size=4>&sect;</font></center>
<p>Khi join chỉ có 1 điều kiện, các thể để điều kiện cùng dòng với join</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">charges</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_revenue</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
</section>
<section id="cac-cot-duoc-group-duoc-day-len-truoc">
<h2><span class="section-number">4.9. </span>Các cột được group được đẩy lên trước<a class="headerlink" href="#cac-cot-duoc-group-duoc-day-len-truoc" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">  </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">com_created_at</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_year</span><span class="p">,</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_companies</span>
<span class="k">from</span><span class="w"> </span><span class="n">companies</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">signup_year</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_companies</span><span class="p">,</span>
<span class="w">  </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">com_created_at</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_year</span>
<span class="k">from</span><span class="w"> </span><span class="n">mysql_helpscout</span><span class="p">.</span><span class="n">helpscout_companies</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">signup_year</span>
</pre></div>
</div>
</section>
<section id="case-when">
<h2><span class="section-number">4.10. </span>Case when<a class="headerlink" href="#case-when" title="Link to this heading">#</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>

<span class="c1">-- Good too</span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span>
<span class="w">            </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span>
<span class="w">            </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span><span class="w">            </span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>

<span class="c1">-- Bad </span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span><span class="w">        </span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>
</pre></div>
</div>
</section>
<section id="dung-bang-ao-cte">
<h2><span class="section-number">4.11. </span>Dùng bảng ảo CTE<a class="headerlink" href="#dung-bang-ao-cte" title="Link to this heading">#</a></h2>
<p>Khi dùng bảng áo, có các lưu ý format như sau:</p>
<ul class="simple">
<li><p>Đẩy nội dung câu lệnh tạo bảng ảo vào trong (1 tab)</p></li>
<li><p>Đặt tên bảng ảo có ý nghĩa</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">with</span><span class="w"> </span><span class="n">ordered_details</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">user_id</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">date_updated</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">details_rank</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">billingdaddy</span><span class="p">.</span><span class="n">billing_stored_details</span>

<span class="p">),</span>

<span class="n">first_updates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="k">select</span><span class="w"> </span>
<span class="w">        </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">name</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">ordered_details</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span>
<span class="w">        </span><span class="n">details_rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">first_updates</span>
</pre></div>
</div>
</section>
<section id="tai-lieu-tham-khao">
<h2><span class="section-number">4.12. </span>Tài liệu tham khảo<a class="headerlink" href="#tai-lieu-tham-khao" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>https://github.com/mattm/sql-style-guide</p></li>
<li><p>https://about.gitlab.com/handbook/business-technology/data-team/platform/sql-style-guide/</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="p01-03-sql-tuning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>SQL tuning</p>
      </div>
    </a>
    <a class="right-next"
       href="p01-05-tricks-sql.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Mẹo với SQL</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Mục lục
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#viet-thuong-cau-lenh">4.1. Viết thường câu lệnh</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select">4.2. Mỗi cột cần được tách thành các dòng khác nhau trong select</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-dieu-kien-trong-where-can-viet-lui-vao-trong">4.3. Các điều kiện trong where cần viết lùi vào trong</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#can-trai-cac-keyword-chinh">4.4. Căn trái các keyword chính</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#khoang-trang-trong-dau-ngoac">4.5. Khoảng trắng trong dấu ngoặc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tach-dong-trong-dieu-kien-in-nhieu-gia-tri">4.6. Tách dòng trong điều kiện in nhiều giá trị</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ten-cac-bang-va-cot">4.7. Tên các bảng và cột</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-luu-y-format-khi-join">4.8. Các lưu ý format khi join</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-cot-duoc-group-duoc-day-len-truoc">4.9. Các cột được group được đẩy lên trước</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-when">4.10. Case when</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dung-bang-ao-cte">4.11. Dùng bảng ảo CTE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tai-lieu-tham-khao">4.12. Tài liệu tham khảo</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Anh Hoang Duc
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018, Anh Hoang Duc.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>