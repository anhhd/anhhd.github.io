

<!DOCTYPE html>
<html class="writer-html5" lang="vn" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. SQL style guide &mdash; Data Engineer book 2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=0cebd926" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=6c11a7b2"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
      <script src="_static/design-tabs.js?v=f930bc37"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Mẹo với SQL" href="p01-05-tricks-sql.html" />
    <link rel="prev" title="3. SQL tuning" href="p01-03-sql-tuning.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Data Engineer book
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SQL cơ bản</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p01-01-sql-co-ban.html">1. SQL cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-02-sql-nang-cao.html">2. SQL nâng cao</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-03-sql-tuning.html">3. SQL tuning</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. SQL style guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#viet-thuong-cau-lenh">4.1. Viết thường câu lệnh</a></li>
<li class="toctree-l2"><a class="reference internal" href="#moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select">4.2. Mỗi cột cần được tách thành các dòng khác nhau trong select</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-dieu-kien-trong-where-can-viet-lui-vao-trong">4.3. Các điều kiện trong where cần viết lùi vào trong</a></li>
<li class="toctree-l2"><a class="reference internal" href="#can-trai-cac-keyword-chinh">4.4. Căn trái các keyword chính</a></li>
<li class="toctree-l2"><a class="reference internal" href="#khoang-trang-trong-dau-ngoac">4.5. Khoảng trắng trong dấu ngoặc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tach-dong-trong-dieu-kien-in-nhieu-gia-tri">4.6. Tách dòng trong điều kiện in nhiều giá trị</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ten-cac-bang-va-cot">4.7. Tên các bảng và cột</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-luu-y-format-khi-join">4.8. Các lưu ý format khi join</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cac-cot-duoc-group-duoc-day-len-truoc">4.9. Các cột được group được đẩy lên trước</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-when">4.10. Case when</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dung-bang-ao-cte">4.11. Dùng bảng ảo CTE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tai-lieu-tham-khao">4.12. Tài liệu tham khảo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p01-05-tricks-sql.html">5. Mẹo với SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-06-sqlcmd.html">6. SQLCMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-07-sql-project.html">7. SQL prọject</a></li>
<li class="toctree-l1"><a class="reference internal" href="p01-08-sql-va-excel.html">8. Kết nối SQL với Excel phục vụ báo cáo tự động</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Data Engineer book</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">4. </span>SQL style guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/p01-04-sql-style.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sql-style-guide">
<h1><span class="section-number">4. </span>SQL style guide<a class="headerlink" href="#sql-style-guide" title="Link to this heading"></a></h1>
<p>Việc viết chuẩn format code của bất kỳ ngôn ngữ nào đều rất quan trọng, sẽ giúp cho việc theo dõi và đọc code thuận tiện hơn rất nhiều. Các lưu ý khi viết format code SQL</p>
<section id="viet-thuong-cau-lenh">
<h2><span class="section-number">4.1. </span>Viết thường câu lệnh<a class="headerlink" href="#viet-thuong-cau-lenh" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">Select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">From</span><span class="w"> </span><span class="n">users</span>
</pre></div>
</div>
</section>
<section id="moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select">
<h2><span class="section-number">4.2. </span>Mỗi cột cần được tách thành các dòng khác nhau trong select<a class="headerlink" href="#moi-cot-can-duoc-tach-thanh-cac-dong-khac-nhau-trong-select" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">email</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">name</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="cac-dieu-kien-trong-where-can-viet-lui-vao-trong">
<h2><span class="section-number">4.3. </span>Các điều kiện trong where cần viết lùi vào trong<a class="headerlink" href="#cac-dieu-kien-trong-where-can-viet-lui-vao-trong" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;example@domain.com&#39;</span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;example@domain.com&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%@domain.com&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2021-10-08&#39;</span>
</pre></div>
</div>
</section>
<section id="can-trai-cac-keyword-chinh">
<h2><span class="section-number">4.4. </span>Căn trái các keyword chính<a class="headerlink" href="#can-trai-cac-keyword-chinh" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">  </span><span class="n">column_name1</span><span class="p">,</span>
<span class="w">  </span><span class="n">column_name2</span><span class="p">,</span>
<span class="w">  </span><span class="n">column_name3</span>
<span class="k">from</span><span class="w"> </span><span class="n">table_1</span>
<span class="k">join</span><span class="w"> </span><span class="n">table_2</span>
<span class="w">  </span><span class="k">on</span><span class="w"> </span><span class="n">table_1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table_2</span><span class="p">.</span><span class="n">id</span>
<span class="k">where</span><span class="w"> </span><span class="n">clouds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">gem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="k">having</span><span class="w"> </span><span class="n">column_name1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">column_name2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="khoang-trang-trong-dau-ngoac">
<h2><span class="section-number">4.5. </span>Khoảng trắng trong dấu ngoặc<a class="headerlink" href="#khoang-trang-trong-dau-ngoac" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tach-dong-trong-dieu-kien-in-nhieu-gia-tri">
<h2><span class="section-number">4.6. </span>Tách dòng trong điều kiện in nhiều giá trị<a class="headerlink" href="#tach-dong-trong-dieu-kien-in-nhieu-gia-tri" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">where</span><span class="w"> </span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="s1">&#39;user-1@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-2@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-3@example.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;user-4@example.com&#39;</span>
<span class="w">    </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ten-cac-bang-va-cot">
<h2><span class="section-number">4.7. </span>Tên các bảng và cột<a class="headerlink" href="#ten-cac-bang-va-cot" title="Link to this heading"></a></h2>
<p>Vì các bảng và cột thường đặt tên tiếng anh nên với các tên bảng/cột đặt tiếng anh nên các lưu ý như sau:</p>
<ul class="simple">
<li><p>viêt thường</p></li>
<li><p>Bảng đặt tên có dấu</p></li>
<li><p>Cột đặt tên không dấu</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Good</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">visit_logs</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="k">user</span>

<span class="c1">-- Bad</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">from</span><span class="w"> </span><span class="n">visitLog</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_month</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">SignupMonth</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
</pre></div>
</div>
</section>
<section id="cac-luu-y-format-khi-join">
<h2><span class="section-number">4.8. </span>Các lưu ý format khi join<a class="headerlink" href="#cac-luu-y-format-khi-join" title="Link to this heading"></a></h2>
<p>Đặt điều kiện join theo thứ tự bảng</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span>
<span class="c1">-- primary_key = foreign_key --&gt; one-to-many --&gt; fanout</span>
<span class="w">  </span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">charges</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
<span class="c1">-- foreign_key = primary_key --&gt; many-to-one --&gt; no fanout</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">    </span><span class="p">...</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
</pre></div>
</div>
<center><font size=4>&sect;</font></center>
<p>Khi join nhiều điều kiện, cần phân tách điều kiện theo các dòng khác nhau</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">charges</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_revenue</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">and</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">account</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">email</span>
</pre></div>
</div>
<center><font size=4>&sect;</font></center>
<p>Khi join chỉ có 1 điều kiện, các thể để điều kiện cùng dòng với join</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">charges</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_revenue</span>
<span class="k">from</span><span class="w"> </span><span class="n">users</span>
<span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">charges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">charges</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
</section>
<section id="cac-cot-duoc-group-duoc-day-len-truoc">
<h2><span class="section-number">4.9. </span>Các cột được group được đẩy lên trước<a class="headerlink" href="#cac-cot-duoc-group-duoc-day-len-truoc" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">  </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">com_created_at</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_year</span><span class="p">,</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_companies</span>
<span class="k">from</span><span class="w"> </span><span class="n">companies</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">signup_year</span>

<span class="c1">-- Bad</span>
<span class="k">select</span>
<span class="w">  </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_companies</span><span class="p">,</span>
<span class="w">  </span><span class="n">timestamp_trunc</span><span class="p">(</span><span class="n">com_created_at</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">signup_year</span>
<span class="k">from</span><span class="w"> </span><span class="n">mysql_helpscout</span><span class="p">.</span><span class="n">helpscout_companies</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">signup_year</span>
</pre></div>
</div>
</section>
<section id="case-when">
<h2><span class="section-number">4.10. </span>Case when<a class="headerlink" href="#case-when" title="Link to this heading"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>

<span class="c1">-- Good too</span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span>
<span class="w">            </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span>
<span class="w">            </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span><span class="w">            </span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>

<span class="c1">-- Bad </span>
<span class="k">select</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_homepage&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Homepage&#39;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="n">event_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;viewed_editor&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Editor&#39;</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Other&#39;</span><span class="w">        </span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">page_name</span>
<span class="k">from</span><span class="w"> </span><span class="n">events</span>
</pre></div>
</div>
</section>
<section id="dung-bang-ao-cte">
<h2><span class="section-number">4.11. </span>Dùng bảng ảo CTE<a class="headerlink" href="#dung-bang-ao-cte" title="Link to this heading"></a></h2>
<p>Khi dùng bảng áo, có các lưu ý format như sau:</p>
<ul class="simple">
<li><p>Đẩy nội dung câu lệnh tạo bảng ảo vào trong (1 tab)</p></li>
<li><p>Đặt tên bảng ảo có ý nghĩa</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Good</span>
<span class="k">with</span><span class="w"> </span><span class="n">ordered_details</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">user_id</span><span class="p">,</span>
<span class="w">        </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">date_updated</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">details_rank</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">billingdaddy</span><span class="p">.</span><span class="n">billing_stored_details</span>

<span class="p">),</span>

<span class="n">first_updates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="k">select</span><span class="w"> </span>
<span class="w">        </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">name</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">ordered_details</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span>
<span class="w">        </span><span class="n">details_rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">first_updates</span>
</pre></div>
</div>
</section>
<section id="tai-lieu-tham-khao">
<h2><span class="section-number">4.12. </span>Tài liệu tham khảo<a class="headerlink" href="#tai-lieu-tham-khao" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>https://github.com/mattm/sql-style-guide</p></li>
<li><p>https://about.gitlab.com/handbook/business-technology/data-team/platform/sql-style-guide/</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="p01-03-sql-tuning.html" class="btn btn-neutral float-left" title="3. SQL tuning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="p01-05-tricks-sql.html" class="btn btn-neutral float-right" title="5. Mẹo với SQL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Anh Hoang Duc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>